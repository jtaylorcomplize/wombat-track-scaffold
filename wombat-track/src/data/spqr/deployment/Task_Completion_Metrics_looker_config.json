{
  "name": "Task Completion Metrics",
  "dataSource": {
    "name": "Task Completion Metrics Data Source",
    "type": "BIGQUERY",
    "config": {
      "query": "\n        SELECT \n          c.participant_id as client_id,\n          c.display_name as client_name,\n          AVG(cs.satisfaction_rating) as satisfaction_score,\n          cs.survey_date,\n          cs.feedback_category,\n          comm.communication_date,\n          comm.communication_type,\n          AVG(DATEDIFF(comm.response_date, comm.inquiry_date) * 24) as response_time_hours,\n          p.display_name as fee_earner_name,\n          tasks.tasks_completed,\n          tasks.tasks_pending,\n          (tasks.tasks_completed / (tasks.tasks_completed + tasks.tasks_pending) * 100) as completion_rate,\n          AVG(DATEDIFF(tasks.completion_date, tasks.assignment_date)) as avg_completion_time\n        FROM participants c\n        LEFT JOIN client_surveys cs ON c.participant_id = cs.client_id\n        LEFT JOIN communications comm ON c.participant_id = comm.client_id\n        LEFT JOIN participants p ON comm.fee_earner_id = p.participant_id\n        LEFT JOIN (\n          SELECT \n            fee_earner_id,\n            SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as tasks_completed,\n            SUM(CASE WHEN status IN ('pending', 'in_progress') THEN 1 ELSE 0 END) as tasks_pending,\n            completion_date,\n            assignment_date\n          FROM tasks\n          GROUP BY fee_earner_id\n        ) tasks ON p.participant_id = tasks.fee_earner_id\n        WHERE c.participant_type = 'client'\n        GROUP BY c.participant_id, cs.survey_date, comm.communication_date\n      ",
      "dataset": "actionstep_analytics",
      "project": "law-firm-analytics"
    }
  },
  "fields": [
    {
      "name": "fee_earner_id",
      "type": "TEXT",
      "aggregation": "NONE"
    },
    {
      "name": "tasks_completed",
      "type": "NUMBER",
      "aggregation": "COUNT"
    },
    {
      "name": "tasks_pending",
      "type": "NUMBER",
      "aggregation": "COUNT"
    },
    {
      "name": "completion_rate",
      "type": "NUMBER",
      "aggregation": "AVG"
    },
    {
      "name": "avg_completion_time",
      "type": "NUMBER",
      "aggregation": "COUNT"
    }
  ],
  "filters": [],
  "visualization": {
    "type": "LINE_CHART",
    "config": {
      "dimensions": [
        "fee_earner_id"
      ],
      "metrics": [
        "tasks_completed",
        "tasks_pending",
        "completion_rate",
        "avg_completion_time"
      ],
      "colorScheme": "blue_actionstep_theme",
      "showDataLabels": true
    }
  },
  "permissions": {
    "viewRoles": [
      "partner",
      "senior_associate"
    ],
    "editRoles": [
      "admin",
      "partner"
    ]
  },
  "embedConfig": {
    "allowExternalEmbed": false,
    "domains": []
  }
}